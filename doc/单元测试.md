

3.1最佳实践
测试文件命名：我们的测试文件统一名字为 file_test.go，比如 answer.go，则测试文件为 answer_test.go
测试函数命名：方法必须是 TestXxx 开头
测试函数传参：测试函数，参数为 t testing.T。对于 bench 测试，参数为 b testing.B
单一职责：单个测试用例只测单个函数，比如 TestAdd() 是一个测试用例，那么他就测试 Add 函数，不要把 Sub 函数也放到这个里面来进行测试
测试用例运行速度要快：避免在代码中出现 time.sleep() 这种或者其他耗时处理，如有必要可以考虑用并发来进行解决
测试用例之间避免依赖：比如 a ➛ b ➛ c，这样会让测试用例只能顺序执行，导致执行时长变长，同时加大维护难度
备注：如果需要配置测试用例级别的并发执行，可以使用 go test parallel 来配置，同时在单个测试用例中中加入一行代码，文档链接在4.9
用例不依赖特定环境：所有单元测试不可依赖本地数据库中的数据，或者一些特定机器才有的环境变量。
保证测试前后环境一致: 比如对测试中产生的临时文件进行自动化的清理
统一单元测试套件：建议使用这些
用 testify 做 assert 判断
用 testify 构建 单元测试集合，可以写 setup/teardown
用 gomonkey 做 变量，函数，普通的成员方法（公有，私有）的 mock
用 mockery 做接口层面的 mock
用 miniredis 做 redis 的 mock

3.2 建议
不写不必要的测试用例：
建议为这些单元编写测试用例：
逻辑复杂的模块
含核心业务逻辑的模块
需求变更几率大的模块
不建议为这些单元编写测试用例：
一个简单的 SQL 查询
一个简单的 Redis GET/SET 查询
不写重复的测试逻辑：不要在不同层级的测试用例中，去测试同一个逻辑。比如：在 infrastructure 层测试了某个查询的逻辑，那么在 domain service 调用的时候就不用再去测这个查询的逻辑
保证测试代码的易读性: 避免因为是测试代码就太随意。因为它既是代码又是被测试单元的文档，因此需要易读、便于维护
测试的目标是找出我们的错误： 所以不能只测试乐观路径，而是对乐观路径和悲观路径都进行测试
多情况测试优化：我们用 table drive test - 详见4.2

[参考地址](https://zhuanlan.zhihu.com/p/565209330?utm_id=0):

